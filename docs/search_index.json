[["index.html", "AlberdiLab | Comparative metagenomics MSc project Chapter 1 Introduction 1.1 Prepare the R environment", " AlberdiLab | Comparative metagenomics MSc project Irene Martínez, M Thomas P Gilbert, Antton Alberdi1 Last update: 2026-02-02 Chapter 1 Introduction This webbook contains all the code used for data analysis for the comparative metagenomics analysis of gut microbiome bacterial species in several vertebrates. 1.1 Prepare the R environment 1.1.1 Environment To reproduce all the analyses locally, clone this repository in your computer using: RStudio &gt; New Project &gt; Version Control &gt; Git And indicating the following git repository: https://github.com/irene-martinez-garcia/master_thesis.git Once the R project has been created, follow the instructions and code chunks shown in this webbook. 1.1.2 Libraries The following R packages are required for the data analysis. # Base library(R.utils) library(knitr) library(tidyverse) #library(devtools) library(tinytable) library(rairtable) library(janitor) library(broom) # For tree handling library(ape) library(phyloseq) library(phytools) # For plotting library(ggplot2) library(ggrepel) library(ggpubr) library(ggnewscale) library(gridExtra) library(ggtreeExtra) library(ggtree) library(ggh4x) library(UpSetR) library(viridis) # For statistics library(spaa) library(vegan) library(Rtsne) library(geiger) library(distillR) library(ANCOMBC) library(lme4) library(nlme) library(pairwiseAdonis) library(emmeans) library(pheatmap) library(rstatix) library(uwot) University of Copenhagen, antton.alberdi@sund.ku.dk↩︎ "],["data-preparation.html", "Chapter 2 Data preparation 2.1 Searching for the MAGs 2.2 Downloading the MAGs and generating data 2.3 R Studio- Data Analysis 2.4 Wrap working objects", " Chapter 2 Data preparation 2.1 Searching for the MAGs Choose the MAGs For this project, the following bacterial species were selected: Lactococcus lactis, Hafnia paralvei, Enterococcus faecalis, Bacteroides uniformis, Phocaeicola vulgatus, Parabacteroides goldsteinii, Citrobacter braaki, Akkermansia municiphila, Enterococcus hirae and Bacteroides fragilis. EHI MAGs: In the EHI database, select the MAGs with &gt; 90% completeness and &lt; 2.5 contamination for each of the species. GTDB MAGs: (“NCBI Taxonomy” CONTAINS “Lactococcus lactis” AND “CheckM2 Completeness” &gt; “90” AND “CheckM Contamination” &lt; “2.5” AND (“Isolation Source” CONTAINS “feces” OR “Isolation Source” CONTAINS “excrement” OR “Isolation Source” CONTAINS “metagenome” OR “Isolation Source” CONTAINS “microbiome” OR “Isolation Source” CONTAINS “gut” OR “Isolation Source” CONTAINS “faeces” OR “Isolation Source” CONTAINS “fecal”) AND “Isolation Source” IS NOT “N/A”) NCBI MAGs: Refer to 03_downloading_mags.Rmd 2.2 Downloading the MAGs and generating data Download genome indices and metadata Download the EHI_MAG index for each species (in /data/mags_metadata folder) and the curl file and search metadata tsv from the GTDB and place in each species directory in Mjolnir. 2.5) Extract genome metadata - Use the GTDB search tsv to run this script to obtain more metadata. (modify script a bit to make it scalable). python scripts/extract_gtdb_metadata.py Create the master index Run the create_index.R script to create an index of all the MAGs and the download paths (needs a list of species as input and right now it is hardcoded in the script) conda activate mags_r_env Rscript scripts/create_index.R Run the downloading_mags.smk to download all the genomes module load snakemake #testing snakemake -s snakefiles/downloading_and_unzipping.smk \\ --executor slurm \\ --jobs 50 \\ --rerun-incomplete \\ --keep-going Download the MAGs from the NCBI ### DOWNLOAD THE MAGS - add this to download and unzip mags?? datasets download genome accession --inputfile ../lactococcus_lactis_selected_accessions.txt --include genome --filename lactococcus_lactis_selected_genomes.zip zip=&quot;lactococcus_lactis_selected_genomes.zip&quot; mkdir -p unzipped unzip -Z1 &quot;$zip&quot; | grep &#39;\\.fna$&#39; | while read -r f; do acc=$(basename &quot;$(dirname &quot;$f&quot;)&quot;) echo &quot;Extracting $acc&quot; unzip -p &quot;$zip&quot; &quot;$f&quot; &gt; &quot;unzipped/${acc}.fna&quot; done Make a screen session for each species. screen -S parabacteroides_distasonis Run drakkar annotating_function.smk to re-annotate all the MAGs: drakkar annotating -b /maps/projects/alberdilab/people/pjq449/comparative_metagenomics/data/lactococcus_lactis/mags/unzipped -o /maps/projects/alberdilab/people/pjq449/comparative_metagenomics/data/lactococcus_lactis --env_path /projects/alberdilab/data/environments/drakkar --annotation-type function Annotate with prokka snakemake -s snakefiles/prokka_and_pangenome.smk --profile snakefiles/slurm_profile Run drep sbatch scripts/drep_compare.slurm Run create_pangolin_input.R to create the input file ppanggolin needs conda activate mags_r_env Rscript scripts/create_pangolin_input.R #or if we want to use the annotation files by prokka: Rscript scripts/create_pangolin_input_gff.R Pangenome analysis with ppanggolin conda activate ppanggolin ppanggolin all --fasta /maps/projects/alberdilab/people/pjq449/comparative_metagenomics/data/parabacteroides_distasonis_HUMAN_EHI/ppanggolin_input.tsv 2.3 R Studio- Data Analysis 2.3.1 EHI MAGs ehi_mags &lt;- read_csv(&quot;data/ehi_mags.csv&quot;) Rows: 8846 Columns: 52 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;,&quot; chr (36): ID, mag_name, link_to_assembly, AB_batch, eha_number, GTDB_version, GTDB_release, domain, phylum, ... dbl (15): fastani_ani, closest_placement_ani, closest_placement_af, completeness, contamination, size, N50, ... lgl (1): annotated ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. 2.3.2 Prepare color scheme AlberdiLab projects use unified color schemes developed for the Earth Hologenome Initiative, to facilitate figure interpretation. ehi_mags_p &lt;- ehi_mags %&gt;% mutate(phylum=str_remove_all(phylum, &quot;p__&quot;)) phylum_colors &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% mutate(phylum=str_remove_all(phylum, &quot;p__&quot;)) %&gt;% right_join(ehi_mags_p, by=join_by(phylum == phylum)) %&gt;% dplyr::select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% pull(colors, name=phylum) #source_colors &lt;- c(EHI = &quot;#8BC63F&quot;, GTDB = &quot;#2D522D&quot;) source_colors_human &lt;- c(EHI = &quot;#8BC63F&quot;, GTDB = &quot;#A90D00&quot;) 2.3.3 Sample metadata gtdb_search_metadata &lt;- read_tsv(&quot;data/human/gtdb_search_results.tsv&quot;) Warning: One or more parsing issues, call `problems()` on your data frame for details, e.g.: dat &lt;- vroom(...) problems(dat) Rows: 47 Columns: 10 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (7): Accession, Organism Name, NCBI Taxonomy, GTDB Taxonomy, GTDB Type Material, Isolation Source, Isola... dbl (2): CheckM2 Completeness, CheckM Contamination lgl (1): GTDB Representative of Species ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. colnames(gtdb_search_metadata) [1] &quot;Accession&quot; &quot;Organism Name&quot; &quot;NCBI Taxonomy&quot; [4] &quot;GTDB Taxonomy&quot; &quot;GTDB Representative of Species&quot; &quot;GTDB Type Material&quot; [7] &quot;CheckM2 Completeness&quot; &quot;CheckM Contamination&quot; &quot;Isolation Source&quot; [10] &quot;Isolation Source_2&quot; gtdb_accession_metadata&lt;- read_tsv(&quot;data/human/parabacteroides_distasonis_human_GTDB_accession_metadata.tsv&quot;) Rows: 47 Columns: 115 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (69): accession, checkm2_model, checkm_marker_lineage, gtdb_genome_representative, gtdb_taxonomy, gtdb_... dbl (39): ambiguous_bases, checkm2_completeness, checkm2_contamination, checkm_completeness, checkm_contami... lgl (5): gtdb_representative, gtdb_type_species_of_genus, mimag_high_quality, mimag_low_quality, mimag_med... date (2): ncbi_date, ncbi_seq_rel_date ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. ehi_metadata &lt;- read_tsv(&quot;data/mags_metadata/parabacteroides_distasonis_metadata.tsv&quot;) %&gt;% mutate(GC = as.numeric(str_remove(GC, &quot;%&quot;))) Rows: 25 Columns: 54 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (38): ID, mag_name, link_to_assembly, AB_batch, eha_number, GTDB_version, GTDB_release, domain, phylum, ... dbl (15): fastani_ani, closest_placement_ani, closest_placement_af, completeness, contamination, size, N50, ... lgl (1): annotated ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. 2.3.4 Load genome mapping # Prepare EHI metadata with standardized column names ehi_clean &lt;- ehi_metadata %&gt;% dplyr::select( ID, species, completeness, contamination, genome_size = size, GC, N50, contigs, host_species, host_order, host_class, assembly_type, isolation_source= sample_type, mag_name, eha_number ) %&gt;% mutate(source = &quot;EHI&quot;) # Prepare GTDB metadata # Join search and accession metadata gtdb_metadata &lt;- full_join(gtdb_accession_metadata, gtdb_search_metadata, by = c(&quot;search_accession&quot; = &quot;Accession&quot;) ) # Prepare GTDB metadata gtdb_clean &lt;- gtdb_metadata %&gt;% dplyr::select( ID = search_accession, completeness = &quot;checkm2_completeness&quot;, contamination = &quot;checkm2_contamination&quot;, gtdb_taxonomy = &quot;GTDB Taxonomy&quot;, isolation_source = &quot;Isolation Source&quot;, genome_size, GC = gc_percentage, N50 = n50_contigs, contigs = contig_count, ncbi_country, mimag_high_quality, mimag_medium_quality, gtdb_representative, mag_name = search_accession )%&gt;% mutate(source = &quot;GTDB&quot;) #Join genome_metadata &lt;- bind_rows(ehi_clean, gtdb_clean) # Read master index master_index &lt;- read_tsv(&quot;data/human/master_mag_index_2.tsv&quot;) %&gt;% filter(species == &quot;parabacteroides_distasonis&quot;) %&gt;% mutate( # Extract the actual genome identifier from out_path genome_identifier = case_when( # For EHI: extract EHA00531_bin.1 from the filename str_detect(out_path, &quot;EHA&quot;) ~ str_extract(out_path, &quot;EHA[0-9]+_bin\\\\.[0-9]+&quot;), # For NCBI: use the ID as is (GCA/GCF number) TRUE ~ ID ) ) Rows: 72 Columns: 4 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (4): species, ID, MAG_url, out_path ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. # Check the mapping print(&quot;Master index mapping:&quot;) [1] &quot;Master index mapping:&quot; master_index %&gt;% dplyr::select(ID, genome_identifier, out_path) %&gt;% head(10) %&gt;% print() # A tibble: 0 × 3 # ℹ 3 variables: ID &lt;chr&gt;, genome_identifier &lt;chr&gt;, out_path &lt;chr&gt; # Read contig-to-genome mapping contig_to_genome &lt;- read_tsv(&quot;data/human/contig_to_mag.tsv&quot;, col_names = c(&quot;contig&quot;, &quot;genome_filename&quot;)) Rows: 10094 Columns: 2 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (2): contig, genome_filename ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. 2.3.5 Genome annotations genome_annotations &lt;-read_tsv(&quot;data/human/gene_annotations_human.tsv.xz&quot;) Warning: One or more parsing issues, call `problems()` on your data frame for details, e.g.: dat &lt;- vroom(...) problems(dat) Rows: 275277 Columns: 13 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (11): gene, strand, kegg, ec, pfam, cazy, resistance_type, resistance_target, vf, vf_type, signalp dbl (2): start, end ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. # Read annotations and add IDs genome_annotations &lt;- read_tsv(&quot;data/human/gene_annotations_human.tsv.xz&quot;) %&gt;% mutate(contig = sub(&quot;_[^_]*$&quot;, &quot;&quot;, gene)) %&gt;% left_join(contig_to_genome, by = &quot;contig&quot;) %&gt;% mutate(genome= genome_filename)%&gt;% filter(!is.na(genome)) Warning: One or more parsing issues, call `problems()` on your data frame for details, e.g.: dat &lt;- vroom(...) problems(dat) Rows: 275277 Columns: 13 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (11): gene, strand, kegg, ec, pfam, cazy, resistance_type, resistance_target, vf, vf_type, signalp dbl (2): start, end ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. 2.3.6 Distill annotations into GIFTs genome_gifts &lt;- distill(genome_annotations,GIFT_db,genomecol= 15, annotcol=c(5,6,7,8), verbosity = T) 2.3.7 Load trees genome_metadata$mag_name &lt;- sub(&quot;\\\\.fa$&quot;, &quot;&quot;, genome_metadata$mag_name)#remove .fa from the mag names so that they match the tree ids getphylo_tree &lt;- read_tree(&quot;data/combined_alignment.tree&quot;) getphylo_tree$tip.label &lt;- gsub(&quot;&#39;&quot;, &quot;&quot;, getphylo_tree$tip.label) tip_df &lt;- data.frame(label = getphylo_tree$tip.label) %&gt;% left_join(genome_metadata, by = c(&quot;label&quot; = &quot;mag_name&quot;)) #replace long mag names with IDs getphylo_tree$tip.label &lt;- tip_df$ID 2.4 Wrap working objects All working objects are wrapped into a single Rdata object to facilitate downstream usage. save(ehi_mags, phylum_colors, genome_annotations, genome_gifts, contig_to_genome, gtdb_metadata, ehi_metadata, master_index, genome_metadata, source_colors, getphylo_tree, file = &quot;data/human/data.Rdata&quot;) "],["ehi-mags-exploration.html", "Chapter 3 EHI MAGs exploration", " Chapter 3 EHI MAGs exploration 3.0.1 EHI MAGs load(&quot;data/data.Rdata&quot;) ehi_mags &lt;- read_csv(&quot;data/ehi_metadata_location.csv&quot;) Rows: 8857 Columns: 54 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;,&quot; chr (38): ID, mag_name, link_to_assembly, AB_batch, eha_number, GTDB_version, GTDB_release, domain, phylum, ... dbl (15): fastani_ani, closest_placement_ani, closest_placement_af, completeness, contamination, size, N50, ... lgl (1): annotated ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. colnames(ehi_mags) [1] &quot;ID&quot; &quot;mag_name&quot; &quot;link_to_assembly&quot; [4] &quot;AB_batch&quot; &quot;eha_number&quot; &quot;GTDB_version&quot; [7] &quot;GTDB_release&quot; &quot;domain&quot; &quot;phylum&quot; [10] &quot;class&quot; &quot;order&quot; &quot;family&quot; [13] &quot;genus&quot; &quot;species&quot; &quot;fastani_ani&quot; [16] &quot;closest_placement_ani&quot; &quot;closest_placement_af&quot; &quot;completeness&quot; [19] &quot;contamination&quot; &quot;size&quot; &quot;GC&quot; [22] &quot;N50&quot; &quot;coding_density&quot; &quot;contigs&quot; [25] &quot;number_genes&quot; &quot;number_unannotated_genes&quot; &quot;DM_batch&quot; [28] &quot;host_species&quot; &quot;host_order&quot; &quot;host_class&quot; [31] &quot;locality&quot; &quot;country&quot; &quot;MAG_url&quot; [34] &quot;anno_url&quot; &quot;kegg_url&quot; &quot;annotated&quot; [37] &quot;taxonomy_level&quot; &quot;assembly_type&quot; &quot;sample_type&quot; [40] &quot;gbk_url&quot; &quot;kegg_hits&quot; &quot;Capture ID&quot; [43] &quot;percent_unannotated_genes&quot; &quot;percent_unannotated_kegg&quot; &quot;dereplicated&quot; [46] &quot;metagenomic source&quot; &quot;completeness software&quot; &quot;binning software&quot; [49] &quot;assembly quality&quot; &quot;binning parameters&quot; &quot;taxonomic identity marker&quot; [52] &quot;isolation_source&quot; &quot;assembly software&quot; &quot;Submission&quot; Check contamination and completeness genome_biplot &lt;- ehi_mags %&gt;% dplyr::select(c(phylum,completeness,contamination,size)) %&gt;% ggplot(aes(x=completeness,y=contamination,size=size,color=phylum)) + geom_point(alpha=0.7) + xlim(c(70,100)) + ylim(c(10,0)) + scale_color_manual(values=phylum_colors) + labs(y= &quot;Contamination&quot;, x = &quot;Completeness&quot;) + theme_classic() + theme(legend.position = &quot;none&quot;) #Generate contamination boxplot genome_contamination &lt;- ehi_mags %&gt;% ggplot(aes(y=contamination)) + ylim(c(10,0)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_classic() + theme(legend.position = &quot;none&quot;, axis.line = element_blank(), axis.title = element_blank(), axis.text=element_blank(), axis.ticks=element_blank(), plot.margin = unit(c(0, 0, 0.40, 0),&quot;inches&quot;)) #add bottom-margin (top, right, bottom, left) genome_completeness &lt;- ehi_mags %&gt;% ggplot(aes(x=completeness)) + xlim(c(70,100)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_classic() + theme(legend.position = &quot;none&quot;, axis.line = element_blank(), axis.title = element_blank(), axis.text=element_blank(), axis.ticks=element_blank(), plot.margin = unit(c(0, 0, 0, 0.50),&quot;inches&quot;)) #add left-margin (top, right, bottom, left) #Render composite figure #pdf(&quot;figures/completeness_contamination.pdf&quot;,width=10, height=5) grid.arrange(grobs = list(genome_completeness,genome_biplot,genome_contamination), layout_matrix = rbind(c(1,1,1,1,1,1,1,1,1,1,1,4), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3))) Warning: Removed 1725 rows containing non-finite outside the scale range (`stat_boxplot()`). Warning: No shared levels found between `names(values)` of the manual scale and the data&#39;s colour values. No shared levels found between `names(values)` of the manual scale and the data&#39;s colour values. Warning: Removed 1725 rows containing missing values or values outside the scale range (`geom_point()`). Warning: Removed 1 row containing non-finite outside the scale range (`stat_boxplot()`). Filter by completeness and contamination ehi_mags_filtered &lt;- ehi_mags %&gt;% filter(completeness &gt; 90, contamination &lt; 2.5) 3.0.2 Host classes species_hostclass_counts &lt;- ehi_mags_filtered %&gt;% filter(!is.na(species), species != &quot;&quot;) %&gt;% filter(!is.na(host_class), host_class != &quot;&quot;) %&gt;% group_by(species) %&gt;% summarise( n_mags = n(), n_host_classes = n_distinct(host_class), n_host_species = n_distinct(host_species), host_classes = paste(sort(unique(host_class)), collapse = &quot;, &quot;), host_species = paste(sort(unique(host_species)), collapse = &quot;, &quot;), phylum = paste(unique(phylum), collapse = &quot;, &quot;) ) %&gt;% arrange(desc(n_host_classes)) species_selection_3 &lt;- species_hostclass_counts %&gt;% filter(n_host_classes &gt;= 3) species_selection_2 &lt;- species_hostclass_counts %&gt;% filter(n_host_classes &gt;= 2) species_selection_3 %&gt;% arrange(-n_mags) # A tibble: 14 × 7 species n_mags n_host_classes n_host_species host_classes host_species phylum &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 1 s__Escherichia coli 64 3 20 Aves, Mammalia, Repti… Apodemus fl… p__Ps… 2 s__Pseudomonas aeruginosa 55 4 25 Amphibia, Aves, Mamma… Chloroceryl… p__Ps… 3 s__Lactococcus lactis 38 3 13 Aves, Mammalia, Repti… Barbastella… p__Ba… 4 s__Hafnia paralvei 25 3 10 Amphibia, Mammalia, R… Anguis frag… p__Ps… 5 s__Parabacteroides distasonis 25 3 10 Aves, Mammalia, Repti… Canis famil… p__Ba… 6 s__Enterococcus faecalis 21 3 11 Aves, Mammalia, Repti… Dasyurus ge… p__Ba… 7 s__Bacteroides uniformis 19 3 5 Aves, Mammalia, Repti… Canis famil… p__Ba… 8 s__Phocaeicola vulgatus 19 3 7 Aves, Mammalia, Repti… Canis famil… p__Ba… 9 s__Citrobacter braakii 16 3 9 Amphibia, Mammalia, R… Chalcides s… p__Ps… 10 s__Moellerella wisconsensis 13 3 5 Amphibia, Aves, Mamma… Geospizopsi… p__Ps… 11 s__Enterococcus_B pernyi 8 3 5 Aves, Mammalia, Repti… Miniopterus… p__Ba… 12 s__Buttiauxella gaviniae 7 3 3 Amphibia, Mammalia, R… Lissotriton… p__Ps… 13 s__Morganella morganii_A 7 3 4 Amphibia, Mammalia, R… Dasyurus ge… p__Ps… 14 s__Aeromonas encheleia 4 3 3 Amphibia, Mammalia, R… Lissotriton… p__Ps… species_selection_2 %&gt;% arrange(-n_mags) # A tibble: 63 × 7 species n_mags n_host_classes n_host_species host_classes host_species phylum &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 1 s__Escherichia coli 64 3 20 Aves, Mammalia, Rept… Apodemus fl… p__Ps… 2 s__Pseudomonas aeruginosa 55 4 25 Amphibia, Aves, Mamm… Chloroceryl… p__Ps… 3 s__Helicobacter_C marmotae 48 2 3 Aves, Mammalia Falco eleon… p__Ca… 4 s__Lactococcus lactis 38 3 13 Aves, Mammalia, Rept… Barbastella… p__Ba… 5 s__Hafnia paralvei 25 3 10 Amphibia, Mammalia, … Anguis frag… p__Ps… 6 s__Parabacteroides distasonis 25 3 10 Aves, Mammalia, Rept… Canis famil… p__Ba… 7 s__Enterococcus faecalis 21 3 11 Aves, Mammalia, Rept… Dasyurus ge… p__Ba… 8 s__Bacteroides uniformis 19 3 5 Aves, Mammalia, Rept… Canis famil… p__Ba… 9 s__Phocaeicola vulgatus 19 3 7 Aves, Mammalia, Rept… Canis famil… p__Ba… 10 s__Parabacteroides goldsteinii 17 2 8 Mammalia, Reptilia Lepus europ… p__Ba… # ℹ 53 more rows species_selection_2 %&gt;% group_by(phylum)%&gt;% summarize(n_species = n()) # A tibble: 7 × 2 phylum n_species &lt;chr&gt; &lt;int&gt; 1 p__Bacillota 13 2 p__Bacillota_A 8 3 p__Bacteroidota 14 4 p__Campylobacterota 1 5 p__Fusobacteriota 1 6 p__Pseudomonadota 25 7 p__Verrucomicrobiota 1 species_selection_3 %&gt;% group_by(phylum)%&gt;% summarize(n_species = n()) # A tibble: 3 × 2 phylum n_species &lt;chr&gt; &lt;int&gt; 1 p__Bacillota 3 2 p__Bacteroidota 3 3 p__Pseudomonadota 8 3.0.3 Host classes- after filtering species_selection_f &lt;- species_selection_2 %&gt;% dplyr::filter(n_mags &gt; 10) %&gt;% arrange(desc(n_mags)) species_selection_f # A tibble: 22 × 7 species n_mags n_host_classes n_host_species host_classes host_species phylum &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 1 s__Escherichia coli 64 3 20 Aves, Mammalia, Rept… Apodemus fl… p__Ps… 2 s__Pseudomonas aeruginosa 55 4 25 Amphibia, Aves, Mamm… Chloroceryl… p__Ps… 3 s__Helicobacter_C marmotae 48 2 3 Aves, Mammalia Falco eleon… p__Ca… 4 s__Lactococcus lactis 38 3 13 Aves, Mammalia, Rept… Barbastella… p__Ba… 5 s__Hafnia paralvei 25 3 10 Amphibia, Mammalia, … Anguis frag… p__Ps… 6 s__Parabacteroides distasonis 25 3 10 Aves, Mammalia, Rept… Canis famil… p__Ba… 7 s__Enterococcus faecalis 21 3 11 Aves, Mammalia, Rept… Dasyurus ge… p__Ba… 8 s__Bacteroides uniformis 19 3 5 Aves, Mammalia, Rept… Canis famil… p__Ba… 9 s__Phocaeicola vulgatus 19 3 7 Aves, Mammalia, Rept… Canis famil… p__Ba… 10 s__Parabacteroides goldsteinii 17 2 8 Mammalia, Reptilia Lepus europ… p__Ba… # ℹ 12 more rows species_selection_list&lt;- species_selection_f %&gt;% pull(species) species_selection_f %&gt;% group_by(phylum)%&gt;% summarize(n_species = n()) # A tibble: 7 × 2 phylum n_species &lt;chr&gt; &lt;int&gt; 1 p__Bacillota 4 2 p__Bacillota_A 2 3 p__Bacteroidota 4 4 p__Campylobacterota 1 5 p__Fusobacteriota 1 6 p__Pseudomonadota 9 7 p__Verrucomicrobiota 1 3.0.4 Count host classes per species counts_species_per_class&lt;- species_selection_f %&gt;% group_by(n_host_classes)%&gt;% summarize(n_species = n()) ggplot(counts_species_per_class, aes(x = n_host_classes, y = n_species)) + geom_col() + geom_text( aes(label = n_species), vjust = -0.3, size = 4 ) + labs( title = &quot;Number of Species per Number of Host Classes&quot;, x = &quot;Number of Host Classes&quot;, y = &quot;Number of Species&quot; ) + theme_bw() mags_with_counts &lt;- ehi_mags_filtered %&gt;% left_join(species_hostclass_counts, by = &quot;species&quot;) #filter for mags with &gt;1 host class mags_host2 &lt;- mags_with_counts %&gt;% dplyr::filter(n_host_classes &gt;= 2) n_mags &lt;- mags_host2 %&gt;% group_by(species) %&gt;% summarise(n_mags = n(), .groups = &quot;drop&quot;) We have several MAGs per species, so here we select the “best MAG” (highest completeness and lowest contamination), to have statistics based on the best of each. best_mag_per_species &lt;- mags_host2 %&gt;% filter(species %in% species_selection_list) %&gt;% group_by(species) %&gt;% arrange(desc(completeness), contamination) %&gt;% slice_head(n = 1) %&gt;% ungroup() %&gt;% transmute( species, best_mag_name = mag_name, best_MAG_link = link_to_assembly, best_genome_size = size, best_completeness = completeness, best_contamination = contamination, best_N50 = N50, best_host_classes = host_class, best_assembly_type = assembly_type, best_phylum =str_remove_all(phylum.x, &quot;p__&quot;)) ggplot(best_mag_per_species, aes(x= species, y = best_genome_size, fill = best_phylum))+ scale_color_manual(values=phylum_colors) + scale_fill_manual(values=phylum_colors) + geom_col()+ theme_bw()+ theme(axis.text.x = element_text(angle = 90)) Warning: No shared levels found between `names(values)` of the manual scale and the data&#39;s colour values. Filtering for Parabacteroides distasonis (make into a loop for all the relevant species later) p_dist &lt;- ehi_mags %&gt;% filter(completeness &gt;90, contamination &lt; 2.5, species == &quot;s__Parabacteroides distasonis&quot;) write_tsv(p_dist, &quot;data/mags_metadata/parabacteroides_distasonis_metadata.tsv&quot;) p_dist_index &lt;- p_dist %&gt;% dplyr::select(ID, MAG_url) write_tsv(p_dist_index, &quot;data/mags_metadata/parabacteroides_distasonis_index.tsv&quot;) #Loop through each species in species_selection list for (i in 1:nrow(species_selection_f)) { current_species &lt;- species_selection_f$species[i] #Filter for completeness and contamination #get metadata species_data &lt;- ehi_mags %&gt;% filter(completeness &gt; 90, contamination &lt; 2.5, species == current_species) #get index species_index &lt;- species_data %&gt;% dplyr::select(ID, MAG_url) #Filename from species name filename &lt;- current_species %&gt;% str_replace(&quot;s__&quot;, &quot;&quot;) %&gt;% str_replace_all(&quot; &quot;, &quot;_&quot;) %&gt;% tolower() #export to tsv write_tsv(species_data, paste0(&quot;data/mags_metadata/&quot;, filename, &quot;_metadata.tsv&quot;)) write_tsv(species_index, paste0(&quot;data/mags_metadata/&quot;, filename, &quot;_index.tsv&quot;)) } ### First only with two: all_mags &lt;- ehi_mags %&gt;% filter(completeness &gt; 90, contamination &lt; 2.5, species %in% c(&quot;s__Parabacteroides distasonis&quot;, &quot;s__Phocaeicola vulgatus&quot;)) %&gt;% mutate(species = str_remove(species, &quot;^s__&quot;) %&gt;% str_to_lower() %&gt;% str_replace(&quot; &quot;, &quot;_&quot;), out_path = paste0(&quot;data/&quot;, species, &quot;/mags/&quot;, basename(MAG_url)) ) %&gt;% dplyr::select(species, ID, MAG_url, out_path) write_tsv(all_mags, &quot;all_mags_index.tsv&quot;) "],["ncbi-mags-exploration.html", "Chapter 4 NCBI MAGs exploration 4.1 NCBI MAGs metadata 4.2 Downloading the MAGs after filtering", " Chapter 4 NCBI MAGs exploration 4.1 NCBI MAGs metadata gut_keywords &lt;- c(&quot;ceaca&quot;, &quot;caeca&quot;, &quot;excrement&quot;, &quot;excrements&quot;, &quot;rectal&quot;, &quot;feces&quot;, &quot;stool&quot;, &quot;stools&quot;, &quot;gut&quot;, &quot;cloaca&quot;, &quot;cloacal&quot;, &quot;fecal&quot;, &quot;intestines&quot;, &quot;intestine&quot;, &quot;intestinal&quot;, &quot;cecum&quot;, &quot;ileum&quot;, &quot;jejunum&quot;, &quot;colon&quot;, &quot;rectum&quot;, &quot;rumen&quot;, &quot;anal&quot;, &quot;anus&quot;, &quot;manure&quot;, &quot;faeces&quot;) # Wrap each keyword in word boundaries: \\bkeyword\\b --otherwise artisanal passes the filter pattern &lt;- paste0(&quot;\\\\b(&quot;, paste(gut_keywords, collapse = &quot;|&quot;), &quot;)\\\\b&quot;) # Filter the data #gut_samples &lt;- metadata_wide %&gt;% # filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) Download metadata for each taxa # Trying to download ncbi metadata for mags conda activate drakkar_env conda install -c conda-forge ncbi-datasets-cli ## CITROBACTER BRAAKII datasets summary genome taxon 57706 \\ --as-json-lines &gt; genomes.jsonl #filtering by contamination and completeness jq -c &#39; select( .checkm_info.completeness &gt;= 90 and .checkm_info.contamination &lt;= 2.5 ) &#39; genomes.jsonl &gt; high_quality_genomes.jsonl #put metadata in tsv jq -r &#39; .accession as $asm | .assembly_info.biosample.attributes[]? | [$asm, .name, .value] | @tsv &#39; high_quality_genomes.jsonl &gt; biosample_attributes.tsv 4.1.1 Citrobacter braakii c_braki_metadata &lt;- read_tsv(&quot;data/ncbi/c_braakii_biosample_attributes.tsv&quot;, col_names = c(&quot;assembly&quot;, &quot;attribute&quot;, &quot;value&quot;)) Rows: 1496 Columns: 3 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (3): assembly, attribute, value ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. metadata_wide &lt;- c_braki_metadata %&gt;% pivot_wider( id_cols = assembly, names_from = attribute, values_from = value, values_fn = function(x) x[1] ) source_counts &lt;- metadata_wide %&gt;% filter(!is.na(isolation_source)) %&gt;% dplyr::count(isolation_source, sort = TRUE) source_counts # A tibble: 29 × 2 isolation_source n &lt;chr&gt; &lt;int&gt; 1 food 24 2 rectal swab 14 3 blood 12 4 urine 10 5 Pooled sediment sample collected from floor of pig farm 8 6 Popliteal lymph node of steer 8 7 faecal 8 8 Pooled sediment sample collected from floor of cattle farm 6 9 missing 6 10 sputum 6 # ℹ 19 more rows host_counts &lt;- metadata_wide %&gt;% filter(!is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) host_counts # A tibble: 12 × 2 host n &lt;chr&gt; &lt;int&gt; 1 Homo sapiens 64 2 cow 8 3 Bos taurus 4 4 Sus scrofa cristatus 4 5 Canis lupus familiaris 2 6 Curlew Sandpiper 2 7 European rook 2 8 Milvus milvus 2 9 environmental 2 10 missing 2 11 not available 2 12 pig 2 metadata_wide %&gt;% filter(host == &quot;Homo sapiens&quot;) # A tibble: 64 × 56 assembly isolation_source `ontological term` ifsac_category source_type collected_by collection_date &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 1 GCF_001062165.1 missing &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; UW clinical l… Unknown 2 GCF_002073755.2 blood &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; George Washin… 2014-10-24 3 GCF_012952645.1 urine &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; University of… 2017 4 GCF_013267145.1 clinical isolate &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; University of… Unknown 5 GCF_016501405.1 sputum &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; University of… 2019 6 GCF_016501525.1 urine &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; University of… 2019 7 GCF_016501755.1 tissue &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; University of… 2019 8 GCF_016501785.1 urine &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; University of… 2018 9 GCF_016501885.1 sputum &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; University of… 2019 10 GCF_016501905.1 blood &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; University of… 2018 # ℹ 54 more rows # ℹ 49 more variables: geo_loc_name &lt;chr&gt;, isolate_name_alias &lt;chr&gt;, lat_lon &lt;chr&gt;, strain &lt;chr&gt;, # PublicAccession &lt;chr&gt;, Species &lt;chr&gt;, Genus &lt;chr&gt;, project_name &lt;chr&gt;, sequenced_by &lt;chr&gt;, # sample_type &lt;chr&gt;, host &lt;chr&gt;, host_disease &lt;chr&gt;, note &lt;chr&gt;, `identification method` &lt;chr&gt;, # host_sex &lt;chr&gt;, host_age &lt;chr&gt;, culture_collection &lt;chr&gt;, isolate &lt;chr&gt;, host_disease_outcome &lt;chr&gt;, # host_health_state &lt;chr&gt;, host_description &lt;chr&gt;, host_disease_stage &lt;chr&gt;, study_id &lt;chr&gt;, # biomaterial_provider &lt;chr&gt;, env_broad_scale &lt;chr&gt;, `Tax ID` &lt;chr&gt;, host_tissue_sampled &lt;chr&gt;, temp &lt;chr&gt;, … citrobacter_gut &lt;- metadata_wide %&gt;% filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) citrobacter_gut %&gt;%tt() .table td.tinytable_css_7q31ussl6vdv491fehaq, .table th.tinytable_css_7q31ussl6vdv491fehaq { border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_074ifoohe6gn0q4bayod, .table th.tinytable_css_074ifoohe6gn0q4bayod { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } assembly isolation_source ontological term ifsac_category source_type collected_by collection_date geo_loc_name isolate_name_alias lat_lon strain PublicAccession Species Genus project_name sequenced_by sample_type host host_disease note identification method host_sex host_age culture_collection isolate host_disease_outcome host_health_state host_description host_disease_stage study_id biomaterial_provider env_broad_scale Tax ID host_tissue_sampled temp identified_by genotype host_subject_id purpose_of_sampling sample_name organism reference_material ENA-CHECKLIST ENA-FIRST-PUBLIC ENA-LAST-UPDATE External Id INSDC center name INSDC first public INSDC last update INSDC status Submitter Id anonymized name common name scientific_name serovar supplier_name GCF_030131705.1 feces NA NA NA NA 2021 Ireland NA NA MCF1305 NA NA NA NA NA faeces Homo sapiens NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA faeces 37 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCF_036957665.1 Feces swab NA NA NA University of Antwerp 2017-10-10 Netherlands NA 52.848781 N 5.838421 E 2200210 NA NA NA NA NA NA pig NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCF_046518655.1 feces NA NA animal University of Veterinary Sciences, Brno 2010 Italy NA NA HI_130_DDST- NA NA NA NA NA NA European rook NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA research NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCF_046555535.1 rectal swab NA NA NA university hospital regensburg 2022-04-25 Germany: Bavaria NA 49 N 12 E 8889 NA NA NA NA NA NA Homo sapiens not collected NA NA NA NA NA NA NA NA patient 3788 NA NA NA NA NA NA NA NA missing NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCF_046555695.1 rectal swab NA NA NA university hospital regensburg 2022-03-14 Germany: Bavaria NA 49 N 12 E 8196 NA NA NA NA NA NA Homo sapiens not collected NA NA NA NA NA NA NA NA patient 3503 NA NA NA NA NA NA NA NA missing NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCF_046555735.1 rectal swab NA NA NA university hospital regensburg 2021-08-26 Germany: Bavaria NA 49 N 12 E 4535 NA NA NA NA NA NA Homo sapiens not collected NA NA NA NA NA NA NA NA patient 2632 NA NA NA NA NA NA NA NA missing NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCF_046559175.1 rectal swab NA NA NA university hospital regensburg 2024-02-26 Germany: Bavaria NA 49 N 12 E 23x9799 NA NA NA NA NA NA Homo sapiens not collected NA NA NA NA NA NA NA NA patient 8887 NA NA NA NA NA NA NA NA ST356 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCF_047313245.1 cloacal swab NA NA NA NA 2021-12 Spain: Binaced NA NA BP327h NA NA NA NA NA single cell Milvus milvus NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA 1273 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCF_050782755.1 rectal swab NA NA NA University Medicine Greifswald 2024-07-12 Germany: Mecklenburg Western Pomerania NA 54.09 N 13.40 E ST1042v NA NA NA NA NA NA Homo sapiens not collected NA NA NA NA NA NA NA NA Patient 9 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCF_054185985.1 rectal swab NA NA NA University Hospital Heidelberg 2022-08-08 Germany: Heidelberg NA 49.41558000 N 8.66535380 E KE10746 NA NA NA NA NA NA Homo sapiens not provided NA NA male 64 years NA NA NA NA NA NA NA NA NA NA NA NA NA ST268 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCF_054186025.1 rectal swab NA NA NA University Hospital Heidelberg 2023-09-06 Germany: Heidelberg NA 49.41558000 N 8.66535380 E KE11267 NA NA NA NA NA NA Homo sapiens not provided NA NA male 47 years NA NA NA NA NA NA NA NA NA NA NA NA NA no ST NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCA_030131705.1 feces NA NA NA NA 2021 Ireland NA NA MCF1305 NA NA NA NA NA faeces Homo sapiens NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA faeces 37 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCA_036957665.1 Feces swab NA NA NA University of Antwerp 2017-10-10 Netherlands NA 52.848781 N 5.838421 E 2200210 NA NA NA NA NA NA pig NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCA_046518655.1 feces NA NA animal University of Veterinary Sciences, Brno 2010 Italy NA NA HI_130_DDST- NA NA NA NA NA NA European rook NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA research NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCA_046555535.1 rectal swab NA NA NA university hospital regensburg 2022-04-25 Germany: Bavaria NA 49 N 12 E 8889 NA NA NA NA NA NA Homo sapiens not collected NA NA NA NA NA NA NA NA patient 3788 NA NA NA NA NA NA NA NA missing NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCA_046555695.1 rectal swab NA NA NA university hospital regensburg 2022-03-14 Germany: Bavaria NA 49 N 12 E 8196 NA NA NA NA NA NA Homo sapiens not collected NA NA NA NA NA NA NA NA patient 3503 NA NA NA NA NA NA NA NA missing NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCA_046555735.1 rectal swab NA NA NA university hospital regensburg 2021-08-26 Germany: Bavaria NA 49 N 12 E 4535 NA NA NA NA NA NA Homo sapiens not collected NA NA NA NA NA NA NA NA patient 2632 NA NA NA NA NA NA NA NA missing NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCA_046559175.1 rectal swab NA NA NA university hospital regensburg 2024-02-26 Germany: Bavaria NA 49 N 12 E 23x9799 NA NA NA NA NA NA Homo sapiens not collected NA NA NA NA NA NA NA NA patient 8887 NA NA NA NA NA NA NA NA ST356 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCA_047313245.1 cloacal swab NA NA NA NA 2021-12 Spain: Binaced NA NA BP327h NA NA NA NA NA single cell Milvus milvus NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA 1273 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCA_050782755.1 rectal swab NA NA NA University Medicine Greifswald 2024-07-12 Germany: Mecklenburg Western Pomerania NA 54.09 N 13.40 E ST1042v NA NA NA NA NA NA Homo sapiens not collected NA NA NA NA NA NA NA NA Patient 9 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCA_054185985.1 rectal swab NA NA NA University Hospital Heidelberg 2022-08-08 Germany: Heidelberg NA 49.41558000 N 8.66535380 E KE10746 NA NA NA NA NA NA Homo sapiens not provided NA NA male 64 years NA NA NA NA NA NA NA NA NA NA NA NA NA ST268 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA GCA_054186025.1 rectal swab NA NA NA University Hospital Heidelberg 2023-09-06 Germany: Heidelberg NA 49.41558000 N 8.66535380 E KE11267 NA NA NA NA NA NA Homo sapiens not provided NA NA male 47 years NA NA NA NA NA NA NA NA NA NA NA NA NA no ST NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA ## HUMAN summary_counts &lt;- citrobacter_gut %&gt;% dplyr::summarize( total_rows = n(), human_samples = sum( host == &quot;Homo sapiens&quot; | stringr::str_detect(isolation_source, stringr::regex(&quot;human&quot;, ignore_case = TRUE)), na.rm = TRUE ) ) print(summary_counts) # A tibble: 1 × 2 total_rows human_samples &lt;int&gt; &lt;int&gt; 1 22 16 ## OTHER HOSTS other_hosts &lt;- citrobacter_gut %&gt;% dplyr::filter(host != &quot;Homo sapiens&quot; | is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) print(other_hosts) # A tibble: 3 × 2 host n &lt;chr&gt; &lt;int&gt; 1 European rook 2 2 Milvus milvus 2 3 pig 2 4.1.2 Lactococcus lactis ## LACTOCOCCUS LACTIS datasets summary genome taxon 1358 \\ --as-json-lines &gt; lactococcus_genomes.jsonl #filtering by contamination and completeness jq -c &#39; select( .checkm_info.completeness &gt;= 90 and .checkm_info.contamination &lt;= 2.5 ) &#39; lactococcus_genomes.jsonl &gt; lactococcus_high_quality_genomes.jsonl #put metadata in tsv jq -r &#39; .accession as $asm | .assembly_info.biosample.attributes[]? | [$asm, .name, .value] | @tsv &#39; lactococcus_high_quality_genomes.jsonl &gt; lactococcus_biosample_attributes.tsv lactococcus_metadata &lt;- read_tsv(&quot;data/ncbi/lactococcus_biosample_attributes.tsv&quot;, col_names = c(&quot;assembly&quot;, &quot;attribute&quot;, &quot;value&quot;)) Rows: 8854 Columns: 3 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (3): assembly, attribute, value ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. metadata_wide &lt;- lactococcus_metadata %&gt;% filter(attribute != &quot;assembly&quot;) %&gt;% # assembly is in some attribute column, causing issues pivot_wider( id_cols = assembly, names_from = attribute, values_from = value, values_fn = list(value = ~ paste(.x, collapse = &quot;; &quot;)) ) lactococcus_gut &lt;- metadata_wide %&gt;% filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) ## HUMAN summary_counts &lt;- lactococcus_gut %&gt;% dplyr::summarize( total_rows = n(), human_samples = sum( host == &quot;Homo sapiens&quot; | stringr::str_detect(isolation_source, stringr::regex(&quot;human&quot;, ignore_case = TRUE)), na.rm = TRUE ) ) print(summary_counts) # A tibble: 1 × 2 total_rows human_samples &lt;int&gt; &lt;int&gt; 1 46 28 ## OTHER HOSTS other_hosts &lt;- lactococcus_gut %&gt;% dplyr::filter(host != &quot;Homo sapiens&quot; | is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) print(other_hosts) # A tibble: 7 × 2 host n &lt;chr&gt; &lt;int&gt; 1 &lt;NA&gt; 10 2 Grasshopper 2 3 Macaca fascicularis 2 4 Oncorhynchus mykiss 2 5 Oreochromis niloticus 2 6 Rhinolophus capensis 2 7 fish 2 4.1.3 Hafnia paralvei ## HAFNIA PARALVEI datasets summary genome taxon 546367 \\ --as-json-lines &gt; hafnia_genomes.jsonl #filtering by contamination and completeness jq -c &#39; select( .checkm_info.completeness &gt;= 90 and .checkm_info.contamination &lt;= 2.5 ) &#39; hafnia_genomes.jsonl &gt; hafnia_high_quality_genomes.jsonl #put metadata in tsv jq -r &#39; .accession as $asm | .assembly_info.biosample.attributes[]? | [$asm, .name, .value] | @tsv &#39; hafnia_high_quality_genomes.jsonl &gt; hafnia_biosample_attributes.tsv hafnia_metadata &lt;- read_tsv(&quot;data/ncbi/hafnia_biosample_attributes.tsv&quot;, col_names = c(&quot;assembly&quot;, &quot;attribute&quot;, &quot;value&quot;)) Rows: 1454 Columns: 3 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (3): assembly, attribute, value ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. metadata_wide &lt;- hafnia_metadata %&gt;% pivot_wider( id_cols = assembly, names_from = attribute, values_from = value, values_fn = function(x) x[1] ) hafnia_gut &lt;- metadata_wide %&gt;% filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) ## HUMAN summary_counts &lt;- hafnia_gut %&gt;% dplyr::summarize( total_rows = n(), human_samples = sum( host == &quot;Homo sapiens&quot; | stringr::str_detect(isolation_source, stringr::regex(&quot;human&quot;, ignore_case = TRUE)), na.rm = TRUE ) ) print(summary_counts) # A tibble: 1 × 2 total_rows human_samples &lt;int&gt; &lt;int&gt; 1 16 14 ## OTHER HOSTS other_hosts &lt;- hafnia_gut %&gt;% dplyr::filter(host != &quot;Homo sapiens&quot; | is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) print(other_hosts) # A tibble: 2 × 2 host n &lt;chr&gt; &lt;int&gt; 1 &lt;NA&gt; 10 2 Mammuthus primigenius 2 4.1.4 Enterococcus faecalis ## ENTEROCOCCUS FAECALIS datasets summary genome taxon 1351 \\ --as-json-lines &gt; enterococcus_faecalis_genomes.jsonl #filtering by contamination and completeness jq -c &#39; select( .checkm_info.completeness &gt;= 90 and .checkm_info.contamination &lt;= 2.5 ) &#39; enterococcus_faecalis_genomes.jsonl &gt; enterococcus_faecalis_high_quality_genomes.jsonl #put metadata in tsv jq -r &#39; .accession as $asm | .assembly_info.biosample.attributes[]? | [$asm, .name, .value] | @tsv &#39; enterococcus_faecalis_high_quality_genomes.jsonl &gt; enterococcus_faecalis_biosample_attributes.tsv enterococcus_faecalis_metadata &lt;- read_tsv(&quot;data/ncbi/enterococcus_faecalis_biosample_attributes.tsv&quot;, col_names = c(&quot;assembly&quot;, &quot;attribute&quot;, &quot;value&quot;)) Rows: 52193 Columns: 3 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (3): assembly, attribute, value ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. metadata_wide &lt;- enterococcus_faecalis_metadata %&gt;% pivot_wider( id_cols = assembly, names_from = attribute, values_from = value, values_fn = function(x) x[1] ) enterococcus_faecalis_gut &lt;- metadata_wide %&gt;% filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) ## HUMAN summary_counts &lt;- enterococcus_faecalis_gut %&gt;% dplyr::summarize( total_rows = n(), human_samples = sum( host == &quot;Homo sapiens&quot; | stringr::str_detect(isolation_source, stringr::regex(&quot;human&quot;, ignore_case = TRUE)), na.rm = TRUE ) ) print(summary_counts) # A tibble: 1 × 2 total_rows human_samples &lt;int&gt; &lt;int&gt; 1 1318 486 ## OTHER HOSTS other_hosts &lt;- enterococcus_faecalis_gut %&gt;% dplyr::filter(host != &quot;Homo sapiens&quot; | is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) print(other_hosts) # A tibble: 69 × 2 host n &lt;chr&gt; &lt;int&gt; 1 swine 266 2 Gallus gallus domesticus 200 3 &lt;NA&gt; 30 4 Gallus gallus 28 5 chicken 25 6 canine 24 7 pig 20 8 Mus musculus 19 9 cattle 17 10 Spheniscus magellanicus (Magellanic Penguin) 16 # ℹ 59 more rows 4.1.5 Enterococcus hirae ## ENTEROCOCCUS HIRAE datasets summary genome taxon 1354 \\ --as-json-lines &gt; enterococcus_genomes.jsonl #filtering by contamination and completeness jq -c &#39; select( .checkm_info.completeness &gt;= 90 and .checkm_info.contamination &lt;= 2.5 ) &#39; enterococcus_genomes.jsonl &gt; enterococcus_high_quality_genomes.jsonl #put metadata in tsv jq -r &#39; .accession as $asm | .assembly_info.biosample.attributes[]? | [$asm, .name, .value] | @tsv &#39; enterococcus_high_quality_genomes.jsonl &gt; enterococcus_biosample_attributes.tsv enterococcus_metadata &lt;- read_tsv(&quot;data/ncbi/enterococcus_biosample_attributes.tsv&quot;, col_names = c(&quot;assembly&quot;, &quot;attribute&quot;, &quot;value&quot;)) Rows: 6648 Columns: 3 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (3): assembly, attribute, value ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. metadata_wide &lt;- enterococcus_metadata %&gt;% pivot_wider( id_cols = assembly, names_from = attribute, values_from = value, values_fn = function(x) x[1] ) enterococcus_gut &lt;- metadata_wide %&gt;% filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) ## HUMAN summary_counts &lt;- enterococcus_gut %&gt;% dplyr::summarize( total_rows = n(), human_samples = sum( host == &quot;Homo sapiens&quot; | stringr::str_detect(isolation_source, stringr::regex(&quot;human&quot;, ignore_case = TRUE)), na.rm = TRUE ) ) print(summary_counts) # A tibble: 1 × 2 total_rows human_samples &lt;int&gt; &lt;int&gt; 1 188 40 ## OTHER HOSTS other_hosts &lt;- enterococcus_gut %&gt;% dplyr::filter(host != &quot;Homo sapiens&quot; | is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) print(other_hosts) # A tibble: 20 × 2 host n &lt;chr&gt; &lt;int&gt; 1 mouse 40 2 Gallus gallus 16 3 swine 16 4 pigeon 12 5 &lt;NA&gt; 10 6 Spheniscus magellanicus (Magellanic penguin) 8 7 Sus scrofa domesticus 8 8 chicken 8 9 Mus musculus 4 10 Sus scrofa 4 11 cattle 4 12 Arctocephalus australis (South American fur seal) 2 13 Balaenoptera acutorostrata (dwarf minke whale) 2 14 Pig 2 15 Piglets 2 16 Rabbit 2 17 broiler chicken 2 18 equine 2 19 goat 2 20 pig 2 4.1.6 Bacteroides uniformis ## BACTEROIDES UNIFORMIS datasets summary genome taxon 820 \\ --as-json-lines &gt; b_uniformis_genomes.jsonl #filtering by contamination and completeness jq -c &#39; select( .checkm_info.completeness &gt;= 90 and .checkm_info.contamination &lt;= 2.5 ) &#39; b_uniformis_genomes.jsonl &gt; b_uniformis_high_quality_genomes.jsonl #put metadata in tsv jq -r &#39; .accession as $asm | .assembly_info.biosample.attributes[]? | [$asm, .name, .value] | @tsv &#39; b_uniformis_high_quality_genomes.jsonl &gt; b_uniformis_biosample_attributes.tsv b_uniformis_metadata &lt;- read_tsv(&quot;data/ncbi/b_uniformis_biosample_attributes.tsv&quot;, col_names = c(&quot;assembly&quot;, &quot;attribute&quot;, &quot;value&quot;)) Rows: 618 Columns: 3 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (3): assembly, attribute, value ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. metadata_wide &lt;- b_uniformis_metadata %&gt;% filter(attribute != &quot;assembly&quot;) %&gt;% pivot_wider( id_cols = assembly, names_from = attribute, values_from = value, values_fn = function(x) x[1] ) b_uniformis_gut &lt;- metadata_wide %&gt;% filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) ## HUMAN summary_counts &lt;- b_uniformis_gut %&gt;% dplyr::summarize( total_rows = n(), human_samples = sum( host == &quot;Homo sapiens&quot; | stringr::str_detect(isolation_source, stringr::regex(&quot;human&quot;, ignore_case = TRUE)), na.rm = TRUE ) ) print(summary_counts) # A tibble: 1 × 2 total_rows human_samples &lt;int&gt; &lt;int&gt; 1 20 20 ## OTHER HOSTS other_hosts &lt;- b_uniformis_gut %&gt;% dplyr::filter(host != &quot;Homo sapiens&quot; | is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) print(other_hosts) # A tibble: 1 × 2 host n &lt;chr&gt; &lt;int&gt; 1 &lt;NA&gt; 2 4.1.7 Phocaeicola vulgatus ## PHOCAEICOLA VULGATUS datasets summary genome taxon 821 \\ --as-json-lines &gt; p_vulgatus_genomes.jsonl #filtering by contamination and completeness jq -c &#39; select( .checkm_info.completeness &gt;= 90 and .checkm_info.contamination &lt;= 2.5 ) &#39; p_vulgatus_genomes.jsonl &gt; p_vulgatus_high_quality_genomes.jsonl #put metadata in tsv jq -r &#39; .accession as $asm | .assembly_info.biosample.attributes[]? | [$asm, .name, .value] | @tsv &#39; p_vulgatus_high_quality_genomes.jsonl &gt; p_vulgatus_biosample_attributes.tsv p_vulgatus_metadata &lt;- read_tsv(&quot;data/ncbi/p_vulgatus_biosample_attributes.tsv&quot;, col_names = c(&quot;assembly&quot;, &quot;attribute&quot;, &quot;value&quot;)) Rows: 17358 Columns: 3 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (3): assembly, attribute, value ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. metadata_wide &lt;- p_vulgatus_metadata %&gt;% filter(attribute != &quot;assembly&quot;) %&gt;% pivot_wider( id_cols = assembly, names_from = attribute, values_from = value, values_fn = function(x) x[1] ) p_vulgatus_gut &lt;- metadata_wide %&gt;% filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) ## HUMAN summary_counts &lt;- p_vulgatus_gut %&gt;% dplyr::summarize( total_rows = n(), human_samples = sum( host == &quot;Homo sapiens&quot; | stringr::str_detect(isolation_source, stringr::regex(&quot;human&quot;, ignore_case = TRUE)), na.rm = TRUE ) ) print(summary_counts) # A tibble: 1 × 2 total_rows human_samples &lt;int&gt; &lt;int&gt; 1 789 739 ## OTHER HOSTS other_hosts &lt;- p_vulgatus_gut %&gt;% dplyr::filter(host != &quot;Homo sapiens&quot; | is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) print(other_hosts) # A tibble: 7 × 2 host n &lt;chr&gt; &lt;int&gt; 1 &lt;NA&gt; 20 2 Sus scrofa domesticus 18 3 Mus musculus 6 4 Gallus gallus 2 5 Mouse 2 6 Sus scrofa (WT) 2 7 not available 2 4.1.8 Parabacteroides goldsteinii ## PARABACTEROIDES GOLDSTEINII datasets summary genome taxon 328812 \\ --as-json-lines &gt; p_goldsteinii_genomes.jsonl #filtering by contamination and completeness jq -c &#39; select( .checkm_info.completeness &gt;= 90 and .checkm_info.contamination &lt;= 2.5 ) &#39; p_goldsteinii_genomes.jsonl &gt; p_goldsteinii_high_quality_genomes.jsonl #put metadata in tsv jq -r &#39; .accession as $asm | .assembly_info.biosample.attributes[]? | [$asm, .name, .value] | @tsv &#39; p_goldsteinii_high_quality_genomes.jsonl &gt; p_goldsteinii_biosample_attributes.tsv p_goldsteinii_metadata &lt;- read_tsv(&quot;data/ncbi/p_goldsteinii_biosample_attributes.tsv&quot;, col_names = c(&quot;assembly&quot;, &quot;attribute&quot;, &quot;value&quot;)) Rows: 596 Columns: 3 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (3): assembly, attribute, value ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. metadata_wide &lt;- p_goldsteinii_metadata %&gt;% filter(attribute != &quot;assembly&quot;) %&gt;% pivot_wider( id_cols = assembly, names_from = attribute, values_from = value, values_fn = function(x) x[1] ) p_goldsteinii_gut &lt;- metadata_wide %&gt;% filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) ## HUMAN summary_counts &lt;- p_goldsteinii_gut %&gt;% dplyr::summarize( total_rows = n(), human_samples = sum( host == &quot;Homo sapiens&quot; | stringr::str_detect(isolation_source, stringr::regex(&quot;human&quot;, ignore_case = TRUE)), na.rm = TRUE ) ) print(summary_counts) # A tibble: 1 × 2 total_rows human_samples &lt;int&gt; &lt;int&gt; 1 18 6 ## OTHER HOSTS other_hosts &lt;- p_goldsteinii_gut %&gt;% dplyr::filter(host != &quot;Homo sapiens&quot; | is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) print(other_hosts) # A tibble: 1 × 2 host n &lt;chr&gt; &lt;int&gt; 1 &lt;NA&gt; 14 4.1.9 Akkermansia municiphila ## AKKERMANSIA MUNICIPHILA datasets summary genome taxon 239935 \\ --as-json-lines &gt; akkermansia_genomes.jsonl #filtering by contamination and completeness jq -c &#39; select( .checkm_info.completeness &gt;= 90 and .checkm_info.contamination &lt;= 2.5 ) &#39; akkermansia_genomes.jsonl &gt; akkermansia_high_quality_genomes.jsonl #put metadata in tsv jq -r &#39; .accession as $asm | .assembly_info.biosample.attributes[]? | [$asm, .name, .value] | @tsv &#39; akkermansia_high_quality_genomes.jsonl &gt; akkermansia_biosample_attributes.tsv akkermansia_metadata &lt;- read_tsv(&quot;data/ncbi/akkermansia_biosample_attributes.tsv&quot;, col_names = c(&quot;assembly&quot;, &quot;attribute&quot;, &quot;value&quot;)) Rows: 4970 Columns: 3 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (3): assembly, attribute, value ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. metadata_wide &lt;- akkermansia_metadata %&gt;% filter(attribute != &quot;assembly&quot;) %&gt;% pivot_wider( id_cols = assembly, names_from = attribute, values_from = value, values_fn = function(x) x[1] ) akkermansia_gut &lt;- metadata_wide %&gt;% filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) ## HUMAN summary_counts &lt;- akkermansia_gut %&gt;% dplyr::summarize( total_rows = n(), human_samples = sum( host == &quot;Homo sapiens&quot; | stringr::str_detect(isolation_source, stringr::regex(&quot;human&quot;, ignore_case = TRUE)), na.rm = TRUE ) ) print(summary_counts) # A tibble: 1 × 2 total_rows human_samples &lt;int&gt; &lt;int&gt; 1 327 249 ## OTHER HOSTS other_hosts &lt;- akkermansia_gut %&gt;% dplyr::filter(host != &quot;Homo sapiens&quot; | is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) print(other_hosts) # A tibble: 3 × 2 host n &lt;chr&gt; &lt;int&gt; 1 &lt;NA&gt; 66 2 Mus musculus 22 3 Mus musculus C57BL/6 2 4.1.10 Bacteroides fragilis ## BACTEROIDES FRAGILIS datasets summary genome taxon 817 \\ --as-json-lines &gt; b_fragilis_genomes.jsonl #filtering by contamination and completeness jq -c &#39; select( .checkm_info.completeness &gt;= 90 and .checkm_info.contamination &lt;= 2.5 ) &#39; b_fragilis_genomes.jsonl &gt; b_fragilis_high_quality_genomes.jsonl #put metadata in tsv jq -r &#39; .accession as $asm | .assembly_info.biosample.attributes[]? | [$asm, .name, .value] | @tsv &#39; b_fragilis_high_quality_genomes.jsonl &gt; b_fragilis_biosample_attributes.tsv b_fragilis_metadata &lt;- read_tsv(&quot;data/ncbi/b_fragilis_biosample_attributes.tsv&quot;, col_names = c(&quot;assembly&quot;, &quot;attribute&quot;, &quot;value&quot;)) Rows: 10314 Columns: 3 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (3): assembly, attribute, value ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. metadata_wide &lt;- b_fragilis_metadata %&gt;% filter(attribute != &quot;assembly&quot;) %&gt;% pivot_wider( id_cols = assembly, names_from = attribute, values_from = value, values_fn = function(x) x[1] ) b_fragilis_gut &lt;- metadata_wide %&gt;% filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) ## HUMAN summary_counts &lt;- b_fragilis_gut %&gt;% dplyr::summarize( total_rows = n(), human_samples = sum( host == &quot;Homo sapiens&quot; | stringr::str_detect(isolation_source, stringr::regex(&quot;human&quot;, ignore_case = TRUE)), na.rm = TRUE ) ) print(summary_counts) # A tibble: 1 × 2 total_rows human_samples &lt;int&gt; &lt;int&gt; 1 320 268 ## OTHER HOSTS other_hosts &lt;- b_fragilis_gut %&gt;% dplyr::filter(host != &quot;Homo sapiens&quot; | is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) print(other_hosts) # A tibble: 10 × 2 host n &lt;chr&gt; &lt;int&gt; 1 chicken 14 2 dog 12 3 &lt;NA&gt; 12 4 Gallus gallus 6 5 cat 6 6 Piglet 4 7 pig 4 8 Sus scrofa domesticus 2 9 bovine 2 10 porcine 2 4.1.11 Providencia rettgeri ## PROVIDENCIA RETTGERI datasets summary genome taxon 587 \\ --as-json-lines &gt; providencia_genomes.jsonl #filtering by contamination and completeness jq -c &#39; select( .checkm_info.completeness &gt;= 90 and .checkm_info.contamination &lt;= 2.5 ) &#39; providencia_genomes.jsonl &gt; providencia_high_quality_genomes.jsonl #put metadata in tsv jq -r &#39; .accession as $asm | .assembly_info.biosample.attributes[]? | [$asm, .name, .value] | @tsv &#39; providencia_high_quality_genomes.jsonl &gt; providencia_biosample_attributes.tsv providencia_metadata &lt;- read_tsv(&quot;data/ncbi/providencia_biosample_attributes.tsv&quot;, col_names = c(&quot;assembly&quot;, &quot;attribute&quot;, &quot;value&quot;)) Rows: 74 Columns: 3 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (3): assembly, attribute, value ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. metadata_wide &lt;- providencia_metadata %&gt;% filter(attribute != &quot;assembly&quot;) %&gt;% pivot_wider( id_cols = assembly, names_from = attribute, values_from = value, values_fn = function(x) x[1] ) providencia_gut &lt;- metadata_wide %&gt;% filter(str_detect(isolation_source, regex(pattern, ignore_case = TRUE))) ## HUMAN summary_counts &lt;- providencia_gut %&gt;% dplyr::summarize( total_rows = n(), human_samples = sum( host == &quot;Homo sapiens&quot; | stringr::str_detect(isolation_source, stringr::regex(&quot;human&quot;, ignore_case = TRUE)), na.rm = TRUE ) ) print(summary_counts) # A tibble: 1 × 2 total_rows human_samples &lt;int&gt; &lt;int&gt; 1 2 0 ## OTHER HOSTS other_hosts &lt;- providencia_gut %&gt;% dplyr::filter(host != &quot;Homo sapiens&quot; | is.na(host)) %&gt;% dplyr::count(host, sort = TRUE) print(other_hosts) # A tibble: 1 × 2 host n &lt;chr&gt; &lt;int&gt; 1 &lt;NA&gt; 2 selected &lt;- lactococcus_gut %&gt;% pull(assembly) %&gt;% unique() #check length(selected) head(selected) #save the accessions to download the mags in mjolnir writeLines(selected, &quot;data/mags_metadata/lactococcus_lactis_selected_accessions.txt&quot;) 4.2 Downloading the MAGs after filtering Download the MAGs when you finish selecting them ### DOWNLOAD THE MAGS datasets download genome accession --inputfile ../lactococcus_lactis_selected_accessions.txt --include genome --filename lactococcus_lactis_selected_genomes.zip mags_gtdb &lt;- read_tsv(&quot;data/mags_metadata/master_mag_index_lactococcus_lactis.tsv&quot;) %&gt;% pull(ID) Rows: 116 Columns: 4 ── Column specification ──────────────────────────────────────────────────────────────────────────────────────── Delimiter: &quot;\\t&quot; chr (4): species, ID, MAG_url, out_path ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. intersect(selected, mags_gtdb) [1] &quot;GCF_003472365.1&quot; &quot;GCF_014334715.1&quot; &quot;GCF_014830215.1&quot; &quot;GCF_018916825.1&quot; &quot;GCF_020553675.1&quot; &quot;GCF_020782925.1&quot; [7] &quot;GCF_024461915.1&quot; &quot;GCF_024461935.1&quot; &quot;GCF_902364565.1&quot; &quot;GCF_025128595.1&quot; # in selected but NOT in mags_gtdb setdiff(selected, mags_gtdb) [1] &quot;GCF_009497135.1&quot; &quot;GCF_015551225.1&quot; &quot;GCF_015552555.1&quot; &quot;GCF_015666905.1&quot; &quot;GCF_015667015.1&quot; &quot;GCF_015667075.1&quot; [7] &quot;GCF_030480465.1&quot; &quot;GCF_030545485.1&quot; &quot;GCF_039060945.1&quot; &quot;GCF_039061015.1&quot; &quot;GCF_050408585.1&quot; &quot;GCA_003472365.1&quot; [13] &quot;GCA_009497135.1&quot; &quot;GCA_014334715.1&quot; &quot;GCA_014830215.1&quot; &quot;GCA_015551225.1&quot; &quot;GCA_015552555.1&quot; &quot;GCA_015666905.1&quot; [19] &quot;GCA_015667015.1&quot; &quot;GCA_015667075.1&quot; &quot;GCA_018916825.1&quot; &quot;GCA_020553675.1&quot; &quot;GCA_020782925.1&quot; &quot;GCA_024461915.1&quot; [25] &quot;GCA_024461935.1&quot; &quot;GCA_030480465.1&quot; &quot;GCA_030545485.1&quot; &quot;GCA_039060945.1&quot; &quot;GCA_039061015.1&quot; &quot;GCA_050408585.1&quot; [31] &quot;GCA_902364565.1&quot; &quot;GCF_001672265.1&quot; &quot;GCA_001672265.1&quot; &quot;GCF_040516025.1&quot; &quot;GCA_025128595.1&quot; &quot;GCA_040516025.1&quot; # in mags_gtdb but NOT in selected setdiff(mags_gtdb, selected) [1] &quot;EHM013277&quot; &quot;EHM015868&quot; &quot;EHM016594&quot; &quot;EHM017294&quot; &quot;EHM019886&quot; [6] &quot;EHM020035&quot; &quot;EHM025059&quot; &quot;EHM025679&quot; &quot;EHM027656&quot; &quot;EHM028200&quot; [11] &quot;EHM028346&quot; &quot;EHM028354&quot; &quot;EHM028422&quot; &quot;EHM031001&quot; &quot;EHM031128&quot; [16] &quot;EHM031160&quot; &quot;EHM031663&quot; &quot;EHM034137&quot; &quot;EHM040253&quot; &quot;EHM041306&quot; [21] &quot;EHM041731&quot; &quot;EHM042508&quot; &quot;EHM043079&quot; &quot;EHM044953&quot; &quot;EHM045744&quot; [26] &quot;EHM045766&quot; &quot;EHM045845&quot; &quot;EHM046343&quot; &quot;EHM046444&quot; &quot;EHM056391&quot; [31] &quot;EHM056528&quot; &quot;EHM056720&quot; &quot;EHM057270&quot; &quot;EHM057831&quot; &quot;EHM066565&quot; [36] &quot;EHM066683&quot; &quot;EHM071389&quot; &quot;EHM079037&quot; &quot;GCA_947041925.1&quot; &quot;GCF_027672725.1&quot; [41] &quot;GCF_027672965.1&quot; &quot;GCF_027674685.1&quot; &quot;GCA_947347755.1&quot; &quot;GCA_947072755.1&quot; &quot;GCA_905210045.1&quot; [46] &quot;GCF_027673155.1&quot; &quot;GCF_027672695.1&quot; &quot;GCA_018369575.1&quot; &quot;GCA_948496745.1&quot; &quot;GCA_948644855.1&quot; [51] &quot;GCA_947101685.1&quot; &quot;GCA_947063445.1&quot; &quot;GCF_021961665.1&quot; &quot;GCA_948672875.1&quot; &quot;GCA_948995465.1&quot; [56] &quot;GCA_949470665.1&quot; &quot;GCF_027676035.1&quot; &quot;GCA_948654415.1&quot; &quot;GCF_027676135.1&quot; &quot;GCA_948675165.1&quot; [61] &quot;GCA_949006045.1&quot; &quot;GCA_948850205.1&quot; &quot;GCF_932750895.1&quot; &quot;GCA_948674145.1&quot; &quot;GCA_948698275.1&quot; [66] &quot;GCA_949439745.1&quot; &quot;GCF_027679985.1&quot; &quot;GCA_948741555.1&quot; &quot;GCA_022794425.1&quot; &quot;GCF_027672665.1&quot; [71] &quot;GCA_949460315.1&quot; &quot;GCF_027673085.1&quot; &quot;GCF_027674405.1&quot; &quot;GCF_027672785.1&quot; &quot;GCA_948655095.1&quot; [76] &quot;GCA_018381915.1&quot; &quot;GCA_949428005.1&quot; &quot;GCA_949462505.1&quot; &quot;GCA_949028585.1&quot; &quot;GCA_948718815.1&quot; [81] &quot;GCA_937924215.1&quot; &quot;GCA_937910935.1&quot; &quot;GCA_948703095.1&quot; &quot;GCA_947073355.1&quot; &quot;GCF_027673065.1&quot; [86] &quot;GCA_949444485.1&quot; &quot;GCA_958421465.1&quot; &quot;GCF_027674205.1&quot; &quot;GCF_027672865.1&quot; &quot;GCF_027673305.1&quot; [91] &quot;GCA_948622745.1&quot; &quot;GCA_948896515.1&quot; &quot;GCF_027673485.1&quot; &quot;GCF_027674325.1&quot; &quot;GCF_027672645.1&quot; [96] &quot;GCA_948700895.1&quot; &quot;GCA_948777995.1&quot; &quot;GCA_948514765.1&quot; &quot;GCF_027661125.1&quot; &quot;GCF_027673225.1&quot; [101] &quot;GCF_027688475.1&quot; &quot;GCA_949840595.1&quot; &quot;GCF_027676165.1&quot; &quot;GCA_948544615.1&quot; &quot;GCA_948619675.1&quot; [106] &quot;GCA_948748415.1&quot; "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
